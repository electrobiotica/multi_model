<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>AI Switchboard ‚Äì Comparador Multi-Modelo</title>
    <script src="https://js.puter.com/v2/"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        body { font-family: sans-serif; margin: 20px; max-width: 1200px; }
        textarea, select, button, input[type="file"] { padding: 10px; margin-top: 10px; width: 100%; font-size: 1em; }
        .respuesta { margin-top: 20px; padding: 15px; background: #f4f4f4; border-radius: 12px; white-space: pre-wrap; }
        .respuesta h3 { margin-top: 0; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px; }
        .card { border: 1px solid #ccc; border-radius: 12px; padding: 20px; box-shadow: 2px 2px 12px rgba(0,0,0,0.1); }
    </style>
</head>
<body>
    <h1>ü§ñ AI Switchboard ‚Äì Comparador Multi-Modelo</h1>

    <label for="modo">Modo de entrada:</label>
    <select id="modo">
        <option value="texto">Texto</option>
        <option value="imagen">Imagen (GPT Vision)</option>
        <option value="ocr">OCR (Extraer texto)</option>
    </select>

    <div id="input-texto">
        <textarea id="pregunta" rows="4" placeholder="Escrib√≠ tu consulta..."></textarea>
    </div>

    <div id="input-imagen" style="display:none;">
        <input type="file" id="archivo" accept="image/*">
    </div>

    <label for="modelos">Modelos a usar:</label>
    <select id="modelos" multiple size="6">
        <optgroup label="üß† Texto">
            <option value="gpt-4o">OpenAI ‚Äì GPT-4o</option>
            <option value="openrouter:anthropic/claude-3-sonnet">Claude 3 Sonnet</option>
            <option value="openrouter:google/gemini-2.5-pro">Gemini 2.5 Pro</option>
            <option value="openrouter:deepseek/deepseek-chat">DeepSeek</option>
            <option value="openrouter:xai/grok-1">Grok (xAI)</option>
            <option value="openrouter:mistralai/mistral-7b-instruct">Mistral</option>
        </optgroup>
        <optgroup label="üñºÔ∏è Imagen / OCR">
            <option value="img2txt">OCR ‚Äì Extraer texto</option>
        </optgroup>
    </select>

    <button onclick="consultarModelos()">Comparar Respuestas</button>

    <div class="grid" id="resultados"></div>

    <script>
        document.getElementById("modo").addEventListener("change", () => {
            const modo = document.getElementById("modo").value;
            document.getElementById("input-texto").style.display = (modo === "texto") ? "block" : "none";
            document.getElementById("input-imagen").style.display = (modo !== "texto") ? "block" : "none";
        });

        function limpiarRespuesta(respuesta) {
            if (typeof respuesta === "string") return respuesta;
            if (respuesta?.text && typeof respuesta.text === "string") return respuesta.text;
            if (respuesta?.message?.content && typeof respuesta.message.content === "string") return respuesta.message.content;
            try {
                return JSON.stringify(respuesta, null, 2);
            } catch {
                return "Respuesta inesperada.";
            }
        }

        async function consultarModelos() {
            const modo = document.getElementById("modo").value;
            const pregunta = document.getElementById("pregunta").value.trim();
            const archivo = document.getElementById("archivo").files[0];
            const modelos = Array.from(document.getElementById("modelos").selectedOptions).map(opt => opt.value);
            const contenedor = document.getElementById("resultados");
            contenedor.innerHTML = "";

            if ((modo === "texto" && !pregunta) || (modo !== "texto" && !archivo) || modelos.length === 0) {
                alert("Complet√° la entrada seg√∫n el modo y seleccion√° modelos.");
                return;
            }

            for (const modelo of modelos) {
                const div = document.createElement("div");
                div.className = "card";
                div.innerHTML = `<h3>${modelo}</h3><em>Consultando...</em>`;
                contenedor.appendChild(div);

                try {
                    let res;

                    if (modelo === "img2txt") {
                        res = await puter.ai.img2txt(archivo);
                    } else if (modo === "imagen") {
                        res = await puter.ai.chat("Describe esta imagen", { model: modelo, image: archivo });
                    } else {
                        res = await puter.ai.chat(pregunta, { model: modelo });
                    }

                    const text = limpiarRespuesta(res);
                    div.innerHTML = `<h3>${modelo}</h3>` + marked.parse(text);
                } catch (err) {
                    div.innerHTML = `<h3>${modelo}</h3><span style="color:red;">‚ùå Error consultando este modelo.</span>`;
                    console.error(err);
                }
            }
        }
    </script>
</body>
</html>
